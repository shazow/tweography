<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta content="en-us" http-equiv="Content-Language" />

<title>tweography | Where have I tweeted from?</title>

<script src="http://www.google.com/jsapi"></script>
<script type="text/javascript" src="/static/js/sha1.js"></script>
<script type="text/javascript" src="/static/js/oauth.js"></script>
<script type="text/javascript" src="/static/js/jsoauthapi.js?1"></script>
<script type="text/javascript">
    google.load("jquery", "1");
    google.load("maps", "3", {other_params: "sensor=false&key=ABQIAAAA1PzfNUzENFLkcCUSpDoMQBTdp8DcBBN3_zUEII8WC3eyagMC_xRaY10X15Jkb1K4aNgMeVMSxNtB7g"});

    function render_tweets(r, map) {
        var found_first = false;
        var count = 0;
        $.each(r, function(i, o) {
            if(!o.geo) return true;

            var coords = new google.maps.LatLng(o.geo.coordinates[0], o.geo.coordinates[1]);

            if(!found_first) {
                found_first = true;
                map.setCenter(coords);
                map.setZoom(10);
            }

            var marker = new google.maps.Marker({
                position: coords,
                map: map,
            });
            count++;
        });
        return count;
    };

    function set_logged_in(username) {
        $(".username").text(username);
        $(".user").removeClass('hidden');
    };

    function load_into_map(map) {
        twitter_api.user_timeline({count: 200}, function(r) {
            if(r.length==0) {
                $("#progress").html("You don't have any tweets! :O");
                set_logged_in("you");
                return;
            }
            set_logged_in(r[0].user.screen_name);
            var c = render_tweets(r, map);
            if(c==0) {
                $("#progress").html("You don't have any geotagged tweets. :(");
                return;
            }
            $("#progress").html('Where has @<span class="username">'+ r[0].user.screen_name +'</span> been tweeting?');
        });
    };

    google.setOnLoadCallback(function() {
        OAuth.app = "tweography";
        if(window.location.host == "localhost:8080") OAuth.app = "tweography-test";

        if(OAuth.accessor == undefined) {
            $(".intro").removeClass('hidden');
            $("#login").click(function() { OAuth.auth_redirect(); });
            return;
        }

        $(".results").removeClass('hidden');
        $("#logout").click(function() { clear_cookies(); window.location.reload(); }).show();

        var myOptions = {
          zoom: 2,
          center: new google.maps.LatLng(0, 0),
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          mapTypeControl: false
        };
        map = new google.maps.Map(document.getElementById("map"), myOptions);
        load_into_map(map);
    });
</script>
<script type="text/javascript" src="/static/js/jquery.jsonp-1.1.0.min.js"></script>
<script type="text/javascript" src="/static/js/util.js?1"></script>
<script type="text/javascript" src="/static/js/tweography.js?1"></script>
<link rel="stylesheet" href="/static/css/tweography.css?1" type="text/css">
</head>
<body>

<div id="header">
    <h1><a href="/">Tweography</a></h1>
    <div class="user hidden"><div id="extra">Hi, @<span class="username">you</span>! <span class="button" id="logout">Sign out?</span></div></div>
</div>

<div class="intro content hidden">
    <img src="/static/images/mini-map.png" title="My Tweets plus Google Maps = Tweography" id="mini-map"/>
    <div>
        <h2 class="message">
            Tweography: Your tweets on a map.
        </h2>
        <ol>
            <li><strong>Step 1.</strong> <img src="/static/images/Sign-in-with-Twitter-darker.png" alt="Sign in with Twitter" id="login" class="button" style="margin-bottom: -6px;" /></li>
            <li><strong>Step 2.</strong> Enjoy.</li>
    </div>
</div>

<div class="results content hidden">
    <h2 class="message" id="progress">Loading your Tweets...</h2>
    <div id="map" style="height: 300px;"></div>
</div>

<div id="footer">A weeknight project by @<a href="http://twitter.com/limedaring" title="Designer">limedaring</a> and @<a href="http://twitter.com/shazow" title="Coder">shazow</a>.</div>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-407051-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
  })();
</script>

</body>
</html>
